<!DOCTYPE html>
<html>

<head>
    <meta name="description" content="dbmon argilo" />
    <link href="./lib/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <title>Argilo â€¢ dbmon </title>
    <style>
    .Query {
        position: relative;
    }

    .Query:hover .popover {
        left: -100%;
        width: 100%;
        display: block;
    }
    </style>
</head>

<body>
    <div id="app"></div>
</body>
<script src="../dist/argilo.js"></script>
<script src="ENV.js"></script>
<script src="monitor.js"></script>
<script>
argilo.ready(function() {
    argilo({
        template: argilo.html(document.getElementById('tpl/tpl.html')),
        collector: {
            sampleTimeout: null,
            state: {
              databases: []
            },
            created: function() {
                this.loadSamples = this.loadSamples.bind(this)
            },
            mounted: function() {
                this.sampleTimeout = setInterval(this.loadSamples, 0);
            },
            loadSamples: function() {
                this.state.databases = ENV.generate();
                Monitor.ping();
            },
            unmounted: function() {
                clearInterval(this.sampleTimeout)
            }
        }
    }).compile().appendTo('#app');

})
</script>
<script id="tpl/tpl.html" type="text/template">
    <a href="../index.html">Back</a>
    <table class="table table-striped lastest-data">
        <tbody>
            <tr ag-each="db in state.databases">
                <td class="dbname">${db.dbname}</td>
                <td class="query-count">
                    <span ag-class="db.lastSample.countClassName">${db.lastSample.nbQueries}</span>
                </td>
                <td ag-each="q,idx in db.lastSample.topFiveQueries " class="Query" ag-class="q.elapsedClassName">
                    ${q.formatElapsed}
                    <div class="popover left">
                        <div class="popover-content">${q.query}</div>
                        <div class="arrow"></div>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</script>

</html>
