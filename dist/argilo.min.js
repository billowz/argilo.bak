!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("argilo",e):t.argilo=e()}(this,function(){function t(t,e){return 1==arguments.length?ft[t]:ft[t]=e}function e(t,e){return ft.eq(t,e)}function r(t,e){return ft.hasOwn(t,e)}function n(){}function i(t){return void 0!==t}function s(t){return null===t}function o(t){return void 0===t||null===t}function c(t){return pt.call(t)==yt}function a(t){return pt.call(t)==bt}function u(t){return pt.call(t)==_t}function h(t){return pt.call(t)==xt}function f(t){return pt.call(t)==jt}function l(t){return pt.call(t)==vt}function p(t){var e=pt.call(t);switch(e){case dt:case vt:case xt:case mt:return!0}if(t){var n=t.length;return a(n)&&(0===n||n>0&&r(t,n-1))}return!1}function d(t){return pt.call(t)==gt}function v(t){return pt.call(t)==wt}function g(t){if(o(t))return!0;var e=pt.call(t);switch(e){case yt:case bt:case xt:case gt:return!0}return!1}function y(t,e,n,i){var s=void 0,o=void 0,c=0;n=n||t;for(s in t)if((o=r(t,s))||i===!1){if(e.call(n,t[s],s,t,o)===!1)return!1;c++}return c}function b(t,e,r){var n=0,i=t.length;for(r=r||t;n<i;n++)if(e.call(r,t[n],n,t,!0)===!1)return!1;return n}function _(t,e,r,n){return p(t)?b(t,e,r):o(t)?0:y(t,e,r,n)}function x(t,e,r,n){var i=p(t),s=i?[]:{},o=i?b:y;return o(t,function(t,r){s[r]=e.apply(this,arguments)},r,n),s}function j(t,e,r,n){var i=p(t),s=i?[]:{},o=i?b:y;return o(t,function(t,r){e.apply(this,arguments)&&(i?s.push(t):s[r]=t)}),s}function w(t,e,r,n,i){var s=r;return _(t,function(t,r,n,i){s=e.call(this,s,t,r,n,i)},n,i),s}function m(t,r){for(var n=0,i=t.length;n<i;n++)if(e(t[n],r))return n;return-1}function P(t,r){for(var n=t.length;n-- >0;)if(e(t[n],r))return n;return-1}function O(t,n,i){var s=void 0;for(s in t)if((i===!1||r(t,s))&&e(t[s],n))return s}function C(t,e,r){return p(t)?m(t,e):O(t,e,r)}function E(t,e,r){return p(t)?P(t,e):O(t,e,r)}function S(t,e,r,n,i){var s={};return _(t,function(t,n){s[e?e.apply(this,arguments):n]=r?r.apply(this,arguments):t},n,i),s}function $(t,e,r,n){var i={};return _(t,function(t,r){i[t]=e?e.apply(this,arguments):r},r,n),i}function k(t,e,r,n){var i=[];return _(t,function(t,r){e&&!e.apply(this,arguments)||i.push(r)},r,n),i}function A(t,e,r,n){var i=[];return _(t,function(t,r){e&&!e.apply(this,arguments)||i.push(t)},r,n),i}function L(t,e,n){return r(t,e)?t[e]:n}function N(t){for(var e=void 0,n=void 0,i=1,s=arguments.length;i<s;i++){e=arguments[i];for(n in e)r(e,n)&&!r(t,n)&&(t[n]=e[n])}return t}function B(t,e){var r=void 0,n=Ct.call(t);return n==vt?t:n!=xt?[]:(r=Et[t])?r:(r=e!==!1?Et[t]=[]:[],t.replace(St,function(t,e,n,i){r.push(n?i.replace($t,"$1"):e||t)}),r)}function z(t,e,n,i,s){for(var c=0,a=B(e,s),u=a.length-1,h=void 0;c<u&&!o(t);c++){if(h=a[c],i&&!r(t,h))return n;t=t[h]}return h=a[c],c!=u||o(t)||i&&!r(t,h)?n:t[h]}function F(t,e,n,i){for(var s=0,c=B(e,i),a=c.length-1,u=void 0;s<a&&!o(t);s++){if(u=c[s],n&&!r(t,u))return!1;t=t[u]}return u=c[s],s==a&&!o(t)&&(n?r(t,u):u in t)}function I(t,e,r){for(var n=0,i=B(e,!0),s=i.length-1,c=i[0],a=t,u=void 0;n++<s;)u=a[c],a=o(u)?a[c]={}:u,c=i[n];return a[c]=r,t}function T(t){return t.toUpperCase()}function q(t){return t.replace(Ft,T)}function D(t){return t.replace(It,"")}function M(t){return t.replace(Tt,"")}function G(t){return t.replace(qt,"")}function W(t){for(var e=void 0,r=0;r<4;r++)if(e=Gt[r],e.reg.test(t))return t.replace(e.reg,e.rep);return t}function V(t){for(var e=void 0,r=0;r<4;r++)if(e=Wt[r],e.reg.test(t))return t.replace(e.reg,e.rep);return t}function R(t){var e=(t+"").split(".");return e[0]=e[0].replace(Dt,"$1,"),e.join(".")}function Z(t,e,r,n){var i=t.length,s=i>=e?"":Array(1+e-i>>>0).join(r);return n?t+s:s+t}function H(t,e){function r(t){return t=t?"*"==t?+e[i++]:"$"==t?+e[i]:"$"==t.charAt(t.length-1)?+e[t.slice(0,-1)-1]:+t:0,isFinite(t)?t<0?0:t:0}function n(t){return t&&"*"!=t?"$"==t?e[i]:e[t.slice(0,-1)-1]:e[i++]}var i=0;return t=t.replace(Mt,function(t,e,i,s,c,a){if("%"===a)return"%";var u=n(e);s=r(s),c=c&&r(c.slice(1)),c||0===c||(c="fFeE".indexOf(a)==-1?"d"==a?0:void 0:6);var h=!1,f="",l=!1,p=!1,d=!1,v=void 0,g=void 0;switch(i&&_(i,function(t){switch(t){case" ":case"+":f=t;break;case"-":h=!0;break;case"0":l=!0;break;case"#":p=!0;break;case",":d=!0}}),a){case"c":return String.fromCharCode(+u);case"s":return o(u)&&!isNaN(u)?"":(u+="",c&&u.length>c&&(u=u.slice(0,c)),u.length<s&&(u=Z(u,s,l?"0":" ",!1)),u);case"d":return u=parseInt(u),isNaN(u)?"":(u<0?(v="-",u=-u):v=f,u+="",u.length<s&&(u=Z(u,s,"0",!1)),d&&(u=u.replace(Dt,"$1,")),v+u);case"e":case"E":case"f":case"g":case"G":case"p":case"P":var y=+u;if(isNaN(y))return"";y<0?(v="-",y=-y):v=f;var b=void 0,x=a.toLowerCase();if("p"!=x)b=["toExponential","toFixed","toPrecision"]["efg".indexOf(x)];else{var j=String(u).replace(/[eE].*|[^\d]/g,"");j=(y?j.replace(/^0+/,""):j).length,c&&(c=Math.min(c,j)),b=!c||c<=j?"toPrecision":"toExponential"}if(y=y[b](c),y.length<s&&(y=Z(y,s,"0",!1)),d){var w=y.split(".");w[0]=w[0].replace(Dt,"$1,"),y=w.join(".")}return u=v+y,"EGP".indexOf(a)!=-1?u.toUpperCase():u;case"b":g=2;break;case"o":g=8;break;case"u":g=10;break;case"x":case"X":g=16;break;case"n":return"";default:return t}var m=u>>>0;return v=p&&10!=g&&m&&["0b","0","0x"][g>>3]||"",m=m.toString(g),m.length<s&&(m=Z(m,s,"0",!1)),u=v+m,"X"==a?u.toUpperCase():u}),{format:t,count:i}}function K(t){return H(t,zt.call(arguments,1)).format}function U(t,e){if(!d(t))return t instanceof e;for(var r=t;(r=kt(r))&&r!==Object;)if(r===e)return!0;return e===Object}function X(){}function Y(t){var e=function(){this.constructor.apply(this,arguments)},r=t.extend,n=void 0,i=void 0;return Lt(e,X),d(r)&&r!==Object||(r=X),n=r.prototype,i=Nt(n),e.superclass=n,e.prototype=i,At(e,r),delete t.extend,e.extend(t)}function J(t){var e=arguments.slice();return e[0]=t.prototype,N.apply(null,e),t}function Q(t){return Q.proxy(t)}function tt(t){var e=t!==ce?function(t,e){Q[e]=t}:function(t,e){Q[e]=ne.emptyFunc};ne.each(ae,e),ne.each(t,function(t,e){Q[e]=t})}function et(t,e,r,n){if(!pe)throw new Error("Can not register Watcher in runtime");pe.push({name:t,priority:e,validator:r,builder:n}),pe.sort(function(t,e){return t.priority-e.priority}),logger.info("register observi Watcher[%s], priority = %d",t,e)}function rt(){if(pe){if(ie.nextStatus(),each(pe,function(t){var e=t.validator,r=t.builder;if(!ne.isFunc(e)||e(le))try{if(t=r(le),ne.isFunc(t)&&ne.isExtendOf(t,fe))return de=t,logger.info("apply observi Watcher[%s], priority = %d",t.name,t.priority),!1;logger.error("invalid observi Watcher[%s], priority = %d",t.name,t.priority)}catch(t){logger.error("apply observi Watcher[%s] failed",t)}}),!de)throw new Error("Init observi Watcher Failed");return pe=void 0,de}}function nt(t){var e=de||rt();return new e(t)}function it(){var t=void 0;for(flushing=!0;t=ve.shift();)t.notify();ge=!1}function st(t){ve.push(t),ge||(ge=!0,setTimeout(it,0))}function ot(t){return be.call(t,_e.bindWatcher)?t[_e.bindWatcher]:t[_e.bindWatcher]=nt(t)}function ct(t,e,r,n,i){return t(e,Q.isEnable()?r&&function(t,e,n,i){return r.call(this,Q.proxy(t),e,n,i)}:r,n,i)}function at(t,e){var r=ke.bindObservis,n=ne.parseExpr(e),i=void 0,s=void 0;if(!n.length)throw new Error("Invalid Observi Expression: "+e);return t=Q.obj(t),i=Ae.call(t,r)?t[r]:t[r]={},s=n.join(Le),i[s]||(i[s]=new xe(t,e,n))}function ut(t,e){var r=ke.bindObservis,n=ne.parseExpr(e),i=void 0;if(!n.length)throw new Error("Invalid Observi Expression: "+e);return i=Ae.call(t,r)?t[r]:void 0,i&&i[n.join(Le)]}Object.freeze||(Object.freeze=function(t){return t});var ht=Object.prototype.hasOwnProperty,ft={hasOwn:function(t,e){return ht.call(t,e)},eq:function(t,e){return t===e}},lt=Object.freeze({policy:t,eq:e,hasOwnProp:r,emptyFunc:n}),pt=Object.prototype.toString,dt="[object Arguments]",vt="[object Array]",gt="[object Function]",yt="[object Boolean]",bt="[object Number]",_t="[object Date]",xt="[object String]",jt="[object Object]",wt="[object RegExp]",mt="[object NodeList]",Pt=Object.freeze({argsType:dt,arrayType:vt,funcType:gt,boolType:yt,numberType:bt,dateType:_t,stringType:xt,objectType:jt,regexpType:wt,nodeListType:mt,isDefine:i,isNull:s,isNil:o,isBool:c,isNumber:a,isDate:u,isString:h,isObject:f,isArray:l,isArrayLike:p,isFunc:d,isRegExp:v,isPrimitive:g}),Ot=Object.freeze({each:_,map:x,filter:j,aggregate:w,indexOf:C,lastIndexOf:E,convert:S,reverseConvert:$}),Ct=Object.prototype.toString,Et={},St=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,$t=/\\(\\)?/g,kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__},At=Object.setPrototypeOf||function(t,e){t.__proto__=e},Lt=Object.assign||function(t){for(var e=void 0,n=void 0,i=1,s=arguments.length;i<s;i++){e=arguments[i];for(n in e)r(e,n)&&(t[n]=e[n])}return t},Nt=Object.create||function(t,e){n.prototype=t;var r=new n;return n.prototype=void 0,e&&_(e,function(t,e){r[e]=t.value}),r},Bt=Object.freeze({keys:k,values:A,getOwnProp:L,prototypeOf:kt,setPrototypeOf:At,assign:Lt,assignIf:N,create:Nt,parseExpr:B,get:z,has:F,set:I}),zt=Array.prototype.slice,Ft=/^[a-z]/,It=/^\s+/,Tt=/\s+$/,qt=/(^\s+)|(\s+$)/g,Dt=/(\d)(?=(\d{3})+(?!\d))/g,Mt=/%(\d+\$|\*|\$)?([-+#0, ]*)?(\d+\$?|\*|\$)?(\.\d+\$?|\.\*|\.\$)?([%sfducboxXeEgGpP])/g,Gt=[{reg:/([a-zA-Z]+[^aeiou])y$/,rep:"$1ies"},{reg:/([a-zA-Z]+[aeiou]y)$/,rep:"$1s"},{reg:/([a-zA-Z]+[sxzh])$/,rep:"$1es"},{reg:/([a-zA-Z]+[^sxzhy])$/,rep:"$1s"}],Wt=[{reg:/([a-zA-Z]+[^aeiou])ies$/,rep:"$1y"},{reg:/([a-zA-Z]+[aeiou])s$/,rep:"$1"},{reg:/([a-zA-Z]+[sxzh])es$/,rep:"$1"},{reg:/([a-zA-Z]+[^sxzhy])s$/,rep:"$1"}];K.format=H;var Vt=Object.freeze({upperFirst:q,ltrim:D,rtrim:M,trim:G,plural:W,singular:V,thousandSeparate:R,format:K});Lt(X.prototype,{super:function(t){var e=arguments.callee.caller;e.$owner.superclass[e.$name].apply(this,t||emptyArray)},superclass:function(){var t=arguments.callee.caller;return t.$owner.superclass}}),Lt(X,{extend:function(t){var e=this;if(t){var r=this.prototype;_(t,function(t,n){d(t)&&(t.$owner=e,t.$name=n),r[n]=t}),this.assign(t.statics)}return this},assign:function(t){return t&&Lt(this,t),this}});var Rt=Object.freeze({isExtendOf:U,Base:X,dynamicClass:Y,mixin:J}),Zt="__linked_list__",Ht=1,Kt=Y({statics:{LIST_KEY:Zt},constructor:function(){this._id=Ht++,this.length=0,this._header=void 0,this._tail=void 0,this._version=1},_listObj:function(t){return r(t,Zt)&&t[Zt]},_desc:function(t){var e=this._listObj(t);return e&&e[this._id]},_newDesc:function(t){return{obj:t,prev:void 0,next:void 0,version:this._version++}},_getOrCreateDesc:function(t){var e=this._listObj(t)||(t[Zt]={}),r=e[this._id];return r||(e[this._id]=this._newDesc(t))},_unlink:function(t){var e=t.prev,r=t.next;e?e.next=r:this._header=r,r?r.prev=e:this._tail=e,this.length--},_move:function(t,e,r){var n=this._header;(n===t||t.prev)&&this._unlink(t),t.prev=e,e?(t.next=e.next,e.next=t):(t.next=n,n&&(n.prev=t),this._header=t),this._tail===e&&(this._tail=t),this.length++},_remove:function(t){var e=t.obj,r=this._listObj(e);this._unlink(t),delete r[this._id]},push:function(){var t=this,e=0;return _(arguments,function(r){var n=t._listObj(r)||(r[Zt]={});n[t._id]||(t._move(n[t._id]=t._newDesc(r),t._tail),e++)}),e},pop:function(){var t=this._header;if(t)return this._remove(t),t.obj},shift:function(){var t=this._tail;if(t)return this._remove(t),t.obj},first:function(){var t=arguments.length;if(!t){var e=this._header;return e&&e.obj}for(;t--;)this._move(this._getOrCreateDesc(arguments[t]),void 0);return this},last:function(){var t=this;return arguments.length?(_(arguments,function(e){t._move(t._getOrCreateDesc(e),t._tail)}),this):this._tail&&this._tail.obj},before:function(t){var e=arguments.length,r=this._desc(t),n=r&&r.prev;if(1==e)return n&&n.obj;for(;e-- >1;)this._move(this._getOrCreateDesc(arguments[e]),n);return this},after:function(t){var e=arguments.length,r=this._desc(t);if(1==e){var n=r&&r.next;return n&&n.obj}for(;e-- >1;)this._move(this._getOrCreateDesc(arguments[e]),r);return this},contains:function(t){return!!this._desc(t)},remove:function(){var t=this,e=0;return _(arguments,function(r){var n=t._listObj(r),i=n&&n[t._id];i&&(t._unlink(i),delete n[t._id],e++)}),e},clean:function(){for(var t=this._header;t;)delete this._listObj(t.obj)[this._id],t=t.next;return this._header=void 0,this._tail=void 0,this.length=0,this},empty:function(){return 0==this.length},size:function(){return this.length},each:function(t,e){for(var r=this._header,n=this._version;r;){if(r.version<n&&t.call(e||this,r.obj,this)===!1)return!1;r=r.next}return!0},map:function(t,e){var r=this,n=[];return this.each(function(i){n.push(t.call(e||r,i,r))}),n},filter:function(t,e){var r=this,n=[];return this.each(function(i){t.call(e||r,i,r)&&n.push(i)}),n},toArray:function(){var t=[];return this.each(function(e){t.push(e)}),t}}),Ut=["debug","info","warn","error"],Xt=document.createElement("div"),Yt=Array.prototype.slice,Jt=Y({constructor:function(){Xt.innerHTML='<div id="simulation_console"\n    style="position:absolute; top:0; right:0; font-family:courier,monospace; background:#eee; font-size:10px; padding:10px; width:200px; height:200px;">\n  <a style="float:right; padding-left:1em; padding-bottom:.5em; text-align:right;">Clear</a>\n  <div id="simulation_console_body"></div>\n</div>',this.el=Xt.childNodes[0],this.clearEl=this.el.childNodes[0],this.bodyEl=this.el.childNodes[1]},appendTo:function(t){t.appendChild(this.el)},log:function(t,e){Xt.innerHTML='<span style="'+t+'">'+e+"</span>",this.bodyEl.appendChild(Xt.childNodes[0])},parseMsg:function(t){var e=t[0];if(h(e)){var r=K.format.apply(null,t);return[r.format].concat(Yt.call(t,r.count)).join(" ")}return t.join(" ")},debug:function(){this.log("color: red;",this.parseMsg(arguments))},info:function(){this.log("color: red;",this.parseMsg(arguments))},warn:function(){this.log("color: red;",this.parseMsg(arguments))},error:function(){this.log("color: red;",this.parseMsg(arguments))},clear:function(){this.bodyEl.innerHTML=""}}),Qt=window.console;Qt&&!Qt.debug&&(Qt.debug=function(){Function.apply.call(Qt.log,Qt,arguments)});var te=Y({statics:{enableSimulationConsole:function(){Qt||(Qt=new Jt,Qt.appendTo(document.body))}},constructor:function(t,e){this.module=t,this.level=C(Ut,e||"info")},setLevel:function(t){this.level=C(Ut,t||"info")},getLevel:function(){return Ut[this.level]},_print:function(t,e,r){Function.apply.call(Qt[t],Qt,e),r&&Qt.trace&&Qt.trace()},_log:function(t,e,r){if(!(t<this.level)&&Qt){var n="[%s] %s -"+(h(e[0])?" "+e.shift():""),i=[];e=j(e,function(t){return!(t instanceof Error)||(i.push(t),!1)}),_(i,function(t){e.push.call(e,t.message,"\n",t.stack)}),t=Ut[t],this._print(t,[n,t,this.module].concat(e),r)}},debug:function(){this._log(0,Yt.call(arguments,0))},info:function(){this._log(1,Yt.call(arguments,0))},warn:function(){this._log(2,Yt.call(arguments,0))},error:function(){this._log(3,Yt.call(arguments,0))}});te.logger=new te("default","info");var ee=te.logger,re=Y({constructor:function(t,e,r,n){this.cfg=t||{},this.cfgStatus={},this.listens={},e=e||[],this.statusList=e,this.statusCnt=e.length;var i=C(e,r);i==-1&&(i=0),this.status=e[i],this.statusIdx=i,d(n)&&(this.checkStatus=n)},nextStatus:function(){this.statusIdx<this.statusCnt&&(this.status=this.statusList[this.statusIdx++])},register:function(t,e,r,n){var i=this;return 1==arguments.length?_(t,function(t,n){i.register(n,t,e,r)}):(this.cfg[t]=e,this.cfgStatus[t]={statusIdx:C(this.statusList,r),validator:n}),this},checkStatus:function(t,e,r,n){return r>=n},config:function(t,e){var n=this;if(1==arguments.length)_(t,function(t,e){n.config(e,t)});else if(r(this.cfg,t)){var i=this.cfgStatus[t],s=i.statusIdx,o=i.validator;if(s!=-1&&!this.checkStatus(status,currentStatus,s,currentStatusIdx))return ee.warn("configuration[{}]: must use in status[{}]",t,status),this;if(d(o)&&o(t,e,this)!==!0)return ee.warn("configuration[{}]: invalid value[{}]",t,e),this;var c=this.cfg[t];this.cfg[t]=e,_(this.listens[t],function(r){r(t,e,c,n)})}return this},get:function(t){return arguments.length?this.cfg[t]:Nt(this.cfg)},on:function(t,e){var r=this;if(!d(e))throw new Error("Invalid Callback");return isArray(t)?(_(t,function(t){r.on(t,e)}),this):((this.listens[t]||(this.listens[t]=[])).push(e),this)},un:function(t,e){var r=this;if(isArray(t))_(t,function(t){r.un(t,e)});else{var n=this.listens[t],i=n?C(n,e):-1;i!=-1&&n.splice(i,1)}return this}}),ne=Lt({LinkedList:Kt,Configuration:re},lt,Pt,Ot,Bt,Vt,Rt),ie=new ne.Configuration({},["init","runtime"]);ie.register("bindProxy","__observi_proxy__","init");var se=Object.prototype.hasOwnProperty,oe=ie.get(),ce={eq:function(t,e){return t===e},obj:function(t){return t},proxy:function(t){return t}},ae={change:function(t,e){var r=ne.getOwnProp(t,oe.bindProxy);r&&r.each(function(r){return r(t,e)})},on:function(t,e){if(!ne.isFunc(e))throw TypeError("Invalid Proxy Event Handler["+e);var r=oe.bindProxy,n=ne.getOwnProp(t,r)?t[r]:t[r]=new ne.LinkedList;return 1==n.push(e)},un:function(t,e){var r=ne.getOwnProp(t,oe.bindProxy);return!(!r||!ne.isFunc(e))&&1==r.remove(e)},clean:function(t){t[Q.listenKey]&&(t[Q.listenKey]=void 0)}},ue=!1;ne.assign(Q,{isEnable:function(){return Q.on!==ne.emptyFunc},enable:function(t){tt(t),ue||(ne.policy("hasOwn",function(t,e){return se.call(Q.obj(t),e)}),ne.policy("eq",Q.eq),ue=!0)},disable:function(){tt(ce)}}),Q.disable();var he=!1,fe=ne.dynamicClass({static:{interceptGetter:function(t){he=!0,t(),he=!1}},constructor:function(t){this.obj=t,this.proxy=t,this.getters={},this.setters={},this.watched={}},get:function(t,e){if(he){var r=this.getters[t];r&&r.each(function(r){return r(t,e)})}},set:function(t,e,r){var n=this;if(queue=this.setters[t],queue){var i=Q.eq(e,r);i&&ne.isPrimitive(e)||queue.each(function(s){return s(t,e,r,n,i)})}},getter:function(t,e){return this.accessor(this.getters,t,e)},setter:function(t,e){return this.accessor(this.setters,t,e)},ungetter:function(t,e){return this.unaccessor(this.getters,t,e)},unsetter:function(t,e){return this.unaccessor(this.setters,t,e)},accessor:function(t,e,r){var n=t[e]||(t[e]=new ne.LinkedList),i=1==n.push(r);return i&&!this.watched[e]&&(this.watch(e),this.watched[e]=!0),i},unaccessor:function(t,e,r){var n=t[e];return!!n&&1==n.remove(r)},watch:function(){throw new Error("abstract function watch")}}),le=ie.get(),pe=[],de=void 0,ve=[],ge=!1,ye=new ne.Logger("observi","info");ie.register({bindWatcher:"__watcher__",lazy:!0},"init");var be=Object.prototype.hasOwnProperty,_e=ie.get(),xe=ne.dynamicClass({constructor:function(t,e,r){this.obj=t,this.expr=e,this.path=r,this.watchers=Array(r.length),this.watch(t,0),this.watcher=this.watchers[0],this.handlers=new ne.LinkedList},on:function(t){return this.handlers.push(t)},un:function(t){if(arguments.length)return this.handlers.remove(t);var e=this.landlers.size();return this.handlers.clean(),e},isListened:function(t){return ne.isNil(t)?!this.handlers.empty():this.handlers.contains(t)},fire:function(t,e,r){var n=this.expr,i=this.watcher.proxy;this.handlers.each(function(s){return s(n,t,e,i,r)})},notify:function(){this.dirty&&(this.fire(this.newVal,this.oldVal,this.eq),this.dirty=!1)},update:function(t,e,r){if(_e.lazy){if(this.dirty){if((r=Q.eq(t,this.oldVal))&&ne.isPrimitive(t))return void(this.dirty=!1)}else this.oldVal=e,this.dirty=!0,st(this);this.eq=r,this.newVal=t}else this.fire(t,e,r)},initCallbacks:function(){ne.map(this.path,function(t,e){return this.createCallback(e)},this)},createCallback:function(t){var e=this,r=this.path,n=t+1,i=r.length-n&&r.slice(n),s=void 0,o=!1;return function(c,a,u,h,f){if(i){if(f)return;if(u?(u=Q.obj(u),e.unwatch(u,n),u=o?s:ne.get(u,i)):u=void 0,a){if(Q.isEnable()){a=Q.obj(a);for(var h=e.watch(a,n),l=0,p=e.obj;l<t;)if(p=Q.obj(p[r++]),!p)return;p[r[t]]=h.proxy}else e.watch(a,n);a=s=ne.get(a,i),o=!0}else a=void 0;if((f=Q.eq(a,u))&&ne.isPrimitive(a))return}e.update(a,u,f)}},watch:function(t,e){var r=this.path,n=r[e],i=this.watchers[e]||(this.watchers[e]=ot(t)),s=void 0;return i.setter(n,this.callbacks[e]),++e<r.length&&(s=t[n])&&(Q.isEnable()?t[n]=this.watch(Q.obj(s),e).proxy:this.watch(s,e)),i},unwatch:function(t,e){var r=this.watchers[e];if(r){var n,i=this.path,s=i[e];r.unsetter(s,this.callbacks[e]),++e<i.length&&(n=t[s])&&this.unwatch(Q.obj(n),e)}return r}}),je=Object.prototype.hasOwnProperty;ie.register({enableES6Proxy:!0,bindES6ProxySource:"__observi_proxy_source__",bindES6Proxy:"__observi_proxy__"},"init"),et("ES6Proxy",10,function(t){return window.Proxy&&t.enableES6Proxy!==!1},function(t){var e=t.bindES6ProxySource,r=t.bindES6Proxy;return Q.enable({obj:function(t){return t&&je.call(t,e)?t[e]:t},eq:function(t,e){return t===e||Q.obj(t)===Q.obj(e)},proxy:function(t){return t&&je.call(t,r)?t[r]||t:t}}),ne.dynamicClass({extend:fe,constructor:function(){this.super(arguments),this.binded=!1},watch:function(t){if(!this.binded){var n=this.obj,i=this.createProxy();this.proxy=i,n[r]=i,n[e]=n,Q.change(n,i),this.binded=!0}},createProxy:function(){var t=this;return new Proxy(this.obj,{get:function(e,r){var n=e[r];return t.get(r,n),n},set:function(e,r,n){var i=e[r];return e[r]=n,t.set(r,n,i),!0}})}})});var we=Array.prototype,me=ne.dynamicClass({extend:fe,constructor:function(){this.super(arguments),this.isArray=ne.isArray(this.obj),this.isArray&&this.hookArray()},watch:function(t){return this.isArray&&"length"!=t},hookArray:function(){ne.each(arrayHooks,this.hookArrayMethod,this)},hookArrayMethod:function(t){var e=this.obj,r=we[t],n=(e.length,this);e[t]=function(){var t=e.length,i=r.apply(e,arguments);return n.set("length",e.length,t),i}}});et("ES5DefineProperty",20,function(t){if(Object.defineProperty)try{var e=function(){var t=void 0,e={};return Object.defineProperty(e,"sentinel",{get:function(){return t},set:function(e){t=e}}),e.sentinel=1,{v:e.sentinel===t}}();if("object"==typeof e)return e.v}catch(t){}return!1},function(t){return ne.dynamicClass({extend:me,watch:function(t){var e=this;if(!this.super([t])){var r=this.obj[t];Object.defineProperty(this.obj,t,{enumerable:!0,configurable:!0,get:function(){return e.get(t,r),r},set:function(n){var i=r;r=n,e.set(t,n,i)}})}}})}),et("DefineGetterAndSetter",30,function(t){return"__defineGetter__"in{}},function(t){return ne.dynamicClass({extend:me,watch:function(t){var e=this;if(!this.super([t])){var r=this.obj[t];this.obj.__defineGetter__(t,function(){return e.get(t,r),r}),this.obj.__defineSetter__(t,function(n){var i=r;r=n,e.set(t,n,i)})}}})});var Pe=Object.prototype.hasOwnProperty,Oe="hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Ce="concat,copyWithin,entries,every,fill,filter,find,findIndex,forEach,includes,indexOf,join,keys,lastIndexOf,map,pop,push,reduce,reduceRight,reverse,shift,slice,some,sort,splice,unshift,values".split(","),Ee=void 0,Se=ne.dynamicClass({static:{isSupport:function(){if(void 0!==Ee)return Ee;if(Ee=!1,window.VBArray)try{window.execScript(["Function parseVB(code)","\tExecuteGlobal(code)","End Function"].join("\n"),"VBScript"),Ee=!0}catch(t){ye.error(t.message,t)}return Ee}},constBind:"__vb_constructor__",descBind:"__vb_description__",classNameGenerator:0,constructor:function(t,e){this.classPool={},this.defPropMap={},this.onProxyChange=e,this.addDefProps(t),this.initConstScript()},setConstBind:function(t){this.constBind=t,this.initConstScript()},setDescBind:function(t){this.descBind=t,this.initConstScript()},addDefProps:function(t){var e=this.defPropMap,r=[];ne.each(t||[],function(t){e[t]=!0});for(var n in e)Pe.call(e,n)&&r.push(n);this.defProps=r,ye.info("VBProxy default props is: ",r.join(",")),this.initReserveProps()},initReserveProps:function(){this.reserveProps=Oe.concat(this.defProps),this.reserveArrayProps=this.reserveProps.concat(Ce),this.reservePropMap=ne.reverseConvert(this.reserveProps),this.reserveArrayPropMap=ne.reverseConvert(this.reserveArrayProps)},initConstScript:function(){this.constScript=["\tPublic [",this.descBind,"]\r\n","\tPublic Default Function [",this.constBind,"](desc)\r\n","\t\tset [",this.descBind,"] = desc\r\n","\t\tSet [",this.constBind,"] = Me\r\n","\tEnd Function\r\n"].join("")},generateClassName:function(){return"VBClass"+this.classNameGenerator++},parseClassConstructorName:function(t){return t+"Constructor"},generateSetter:function(t){var e=this.descBind;return["\tPublic Property Get [",t,"]\r\n","\tOn Error Resume Next\r\n","\t\tSet[",t,"] = [",e,'].get("',t,'")\r\n',"\tIf Err.Number <> 0 Then\r\n","\t\t[",t,"] = [",e,'].get("',t,'")\r\n',"\tEnd If\r\n","\tOn Error Goto 0\r\n","\tEnd Property\r\n"]},generateGetter:function(t){var e=this.descBind;return["\tPublic Property Let [",t,"](val)\r\n","\t\tCall [",e,'].set("',t,'",val)\r\n',"\tEnd Property\r\n","\tPublic Property Set [",t,"](val)\r\n","\t\tCall [",e,'].set("',t,'",val)\r\n',"\tEnd Property\r\n"]},generateClass:function(t,e,r){var n=this,i=["Class ",t,"\r\n",this.constScript,"\r\n"];return ne.each(e,function(t){r[t]?i.push("\tPublic ["+t+"]\r\n"):(i.push.apply(i,n.generateSetter(t)),i.push.apply(i,n.generateGetter(t)))}),i.push("End Class\r\n"),i.join("")},generateClassConstructor:function(t,e,r){var n=[t.length,"[",t.join(","),"]","[",r.join(","),"]"].join(""),i=this.classPool[n];if(i)return i;var s=this.generateClassName();return i=this.parseClassConstructorName(s),parseVB(this.generateClass(s,t,e)),parseVB(["Function ",i,"(desc)\r\n","\tDim o\r\n","\tSet o = (New ",s,")(desc)\r\n","\tSet ",i," = o\r\n","End Function"].join("")),this.classPool[n]=i,i},create:function(t,e){function r(e){ne.isFunc(t[e])&&(a[e]=!0,c.push(e)),o.push(e)}var n=this,i=void 0,s=void 0,o=[],c=[],a={},u=this.descBind;return ne.isArray(t)?(i=this.reserveArrayProps,s=this.reserveArrayPropMap):(i=this.reserveProps,s=this.reservePropMap),ne.each(i,r),ne.each(t,function(t,e){e===u||e in s||r(e)},t,!1),e||(e=this.descriptor(t),e?t=e.obj:e=new $e(t,o,this)),proxy=window[this.generateClassConstructor(o,a,c)](e),e.proxy=proxy,ne.each(c,function(e){proxy[e]=n.funcProxy(t[e],e in s?t:proxy)}),this.onProxyChange(t,proxy),e},funcProxy:function(t,e){return function(){return t.apply(this===window?e:this,arguments)}},eq:function(t,e){var r=this.descriptor(t),n=this.descriptor(e);return r&&(t=r.obj),n&&(e=n.obj),t===e},obj:function(t){var e=this.descriptor(t);return e?e.obj:t},proxy:function(t){var e=this.descriptor(t);return e?e.proxy:void 0},isProxy:function(t){return Pe.call(t,this.constBind)},descriptor:function(t){var e=this.descBind;return Pe.call(t,e)?t[e]:void 0},destroy:function(t){this.onProxyChange(obj,void 0)}}),$e=ne.dynamicClass({constructor:function(t,e,r){this.classGenerator=r,this.obj=t,this.defines=ne.reverseConvert(e,function(){return!1}),t[r.descBind]=this,this.accessorNR=0},isAccessor:function(t){return t&&(t.get||t.set)},hasAccessor:function(){return!!this.accessorNR},defineProperty:function(t,e){var r=this.defines,n=this.obj;return t in r||(t in n?ne.isFunc(n[t])&&ye.warn("defineProperty not support function ["+t+"]"):n[t]=void 0,this.classGenerator.create(this.obj,this)),this.isAccessor(e)?(r[t]=e,this.accessorNR++,e.get&&(n[t]=e.get())):(r[t]&&(r[t]=!1,this.accessorNR--),n[t]=e.value),this.proxy},getPropertyDefine:function(t){return this.defines[t]||void 0},get:function(t){var e=this.defines[t];return e&&e.get?e.get.call(this.proxy):this.obj[t]},set:function(t,e){var r=this.defines[t];r&&r.set?r.set.call(this.proxy,e):this.obj[t]=e}});et("VBScriptProxy",40,function(t){return Se.isSupport()},function(t){var e=void 0;return Q.enable({obj:function(t){return t&&e.obj(t)},eq:function(t,e){return t===e||Q.obj(t)===Q.obj(e)},proxy:function(t){return t&&(e.proxy(t)||t)}}),e=new Se([t.bindWatcher,t.bindObservi,t.bindProxy,ne.LinkedList.LIST_KEY].concat(t.defaultProps||[]),Q.change),ne.dynamicClass({extend:me,watch:function(t){var r=this;this.super([t])||(this.proxy=(e.descriptor(obj)||e.create(obj)).defineProperty(t,{set:function(e){var n=obj[t];obj[t]=e,r.set(t,n,e)}}))}})}),ie.register("bindObservis","__observi__","init");var ke=ie.get(),Ae=Object.prototype.hasOwnProperty,Le="###",Ne={Watcher:fe,registerWatcher:et,configuration:ie,logger:ye,proxy:Q,on:function(t,e,r){if(ne.isFunc(r))throw new Error("Invalid Observi Callback");var n=at(Q.obj(t),e);return n.on(r),n.watcher.proxy},un:function(t,e,r){if(ne.isFunc(r))throw new Error("Invalid Observi Callback");var n=ut(Q.obj(t),e);return n?(n.un(r),n.watcher.proxy):t},isListened:function(t,e,r){var n=ut(Q.obj(t),e);return n&&n.isListened(r)},eq:function(t,e){return Q.eq(t,e)},obj:function(t){return Q.obj(t)},$each:function(t,e,r,n){return ct(ne.each,t,e,r,n)},$map:function(t,e,r,n){return ct(ne.map,t,e,r,n)},$filter:function(t,e,r,n){return ct(ne.filter,t,e,r,n)},$aggregate:function(t,e,r,n,i){return ne.aggregate(t,e&&Q.isEnable()?function(t,r,n,i,s){return e.call(this,t,Q.proxy(r),n,i,s)}:e,r,n,i)},$keys:function(t,e,r,n){return ne.keys(t,e&&Q.isEnable()?function(t,r,n,i){return e.call(this,Q.proxy(t),r,n,i)}:e,r,n)},$values:function(t,e,r,n){return ne.values(t,e&&Q.isEnable()?function(t,r,n,i){return e.call(this,Q.proxy(t),r,n,i)}:e,r,n)}},Be=ne.assignIf(ne.create(Ne),{observi:Ne,ilos:ne},ne),ze={observe:Be.on,unobserve:Be.un},Fe=ne.assignIf(ne.create(ze),{argilo:ze,observi:Be,ilos:ne},Be.observi,ne);return Fe});
//# sourceMappingURL=argilo.min.js.map